<!DOCTYPE html>
<html lang="en">
  {% include head.html %}
  <body>
    <script>
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.querySelector('body').classList.add('theme-dark')
      }
    </script>

    <nav class="flex align-center font-ui">
      <span class="flex-grow">
          <a class="internal-link plain" href="/">{{ site.title }}</a>
      </span>
      <span class="flex-shrink ssr">
          <a href="/about" class="muted plain">About</a>
          <a href="/now" class="muted plain ssl mh">Now</a>
          <a href="/gallery" class="muted plain ssl mh">Gallery</a>
      </span>
      <span id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode" type="button" role="switch" aria-checked="false">
          <div class="theme-toggle-slide"></div>
          <div class="theme-toggle-switch"></div>
      </span>
    </nav>

    <main>
      {{ content }}
    </main>

    <footer>
      {% include footer.html %}
    </footer>

    <script>
      var darkModeToggle = document.querySelector("#theme-toggle");

      function toggleTheme() {
        document.body.classList.toggle("theme-dark");
        updateThemeState();
      }

      function updateThemeState() {
        let isDarkMode = document.body.classList.contains("theme-dark");
        let theme = isDarkMode ? "dark" : "light";
        localStorage.setItem("theme", theme);
        darkModeToggle.setAttribute("aria-checked", isDarkMode.toString());
      }

      function initializeTheme() {
        let isDarkMode = document.body.classList.contains("theme-dark");
        darkModeToggle.setAttribute("aria-checked", isDarkMode.toString());
      }

      darkModeToggle.addEventListener("click", toggleTheme);

      window.addEventListener('keydown', function(e) {
          if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') {
            return;
          }
          if ((e.key === 'd' || e.key === 'D') && !e.ctrlKey && !e.metaKey) {
            toggleTheme();
          }
      });

      initializeTheme();
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const article = document.querySelector('article');
        if (!article) return;
        
        const headings = article.querySelectorAll('h2, h3, h4, h5, h6');
        
        headings.forEach(heading => {
          if (!heading.id) return;
          
          const anchor = document.createElement('a');
          anchor.href = '#' + heading.id;
          anchor.classList.add('anchor');
          anchor.innerHTML = '#';
          
          anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const url = window.location.origin + window.location.pathname + '#' + heading.id;
            navigator.clipboard.writeText(url);
            window.location.hash = heading.id;
          });
          
          heading.appendChild(anchor);
        });
      });
    </script>
  </body>
</html>
